/*! pb-gest-product 0.1.3 - Copyright 2015 Palmabit <hello@palmabit.com> (http://www.palmabit.com) */
"use strict";function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),ProductPresenter=function(){function a(b){_classCallCheck(this,a),this.user=b||{}}return _createClass(a,[{key:"presentList",value:function(a){var b;for(b=0;b<a.length;b+=1)this.present(a[b]);return a}},{key:"present",value:function(a){if("object"!=typeof a)throw new TypeError("product must be an object");return a.price||this.getPrice(a),this.getQuantity(a),a}},{key:"getPrice",value:function(a){var b=this.user;return this.getListPrice(a,b.list)?a:this.getListPrice(a,b.list_default)?a:this.getListPrice(a,b.list_active)?a:(a.price=0,a)}},{key:"getListPrice",value:function(a,b){if(Array.isArray(a.prices)&&b)for(var c=0;c<a.prices.length;c+=1)if(a.prices[c].list===b._id)return a.price=a.prices[c].price,a}},{key:"getQuantity",value:function(a){if(a.lots&&a.lots.length>0){a.quantity=0,a.lots.sort(function(a,b){return new Date(a.date)-new Date(b.date)});for(var b=0;b<a.lots.length;b+=1)a.quantity+=a.lots[b].quantity}return a}}]),a}(),ProductVatPresenter=function(a){function b(){_classCallCheck(this,b),_get(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return _inherits(b,a),_createClass(b,[{key:"present",value:function(a){return _get(Object.getPrototypeOf(b.prototype),"present",this).call(this,a),a.vat=this.getVat(a),a}},{key:"getVat",value:function(a){return a.rate_reduced=a.rate_reduced||[],a.rate_exemption?a.rate_exemption:this.user.rate_exemption?this.user.rate_exemption:this.user.rate?this.getVatReduced(a):a.rate?a.rate:this.user.rate_default||null}},{key:"getVatReduced",value:function(a){var b,c;for(b=0;b<a.rate_reduced.length;b+=1)if(c=a.rate_reduced[b],c&&c.name===this.user.rate)return c.vat;return a.rate}}]),b}(ProductPresenter);